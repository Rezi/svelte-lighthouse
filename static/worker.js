const t=Symbol("Comlink.proxy"),e=Symbol("Comlink.endpoint"),n=Symbol("Comlink.releaseProxy"),a=new WeakSet,r=new Map([["proxy",{canHandle:e=>e&&e[t],serialize(t){const{port1:e,port2:n}=new MessageChannel;return o(t,e),[n,[n]]},deserialize:t=>(t.start(),function(t,a){return function t(a,r=[],o=function(){}){let c=!1;const f=new Proxy(o,{get(e,o){if(i(c),o===n)return()=>h(a,{type:5,path:r.map(t=>t.toString())}).then(()=>{s(a),c=!0});if("then"===o){if(0===r.length)return{then:()=>f};const t=h(a,{type:0,path:r.map(t=>t.toString())}).then(l);return t.then.bind(t)}return t(a,[...r,o])},set(t,e,n){i(c);const[o,s]=d(n);return h(a,{type:1,path:[...r,e].map(t=>t.toString()),value:o},s).then(l)},apply(n,o,s){i(c);const d=r[r.length-1];if(d===e)return h(a,{type:4}).then(l);if("bind"===d)return t(a,r.slice(0,-1));const[f,p]=u(s);return h(a,{type:2,path:r.map(t=>t.toString()),argumentList:f},p).then(l)},construct(t,e){i(c);const[n,o]=u(e);return h(a,{type:3,path:r.map(t=>t.toString()),argumentList:n},o).then(l)}});return f}(t,[],a)}(t))}],["throw",{canHandle:t=>a.has(t),serialize(t){const e=t instanceof Error;let n=t;return e&&(n={isError:e,message:t.message,stack:t.stack}),[n,[]]},deserialize(t){if(t.isError)throw Object.assign(new Error,t);throw t}}]]);function o(e,n=self){n.addEventListener("message",function r(i){if(!i||!i.data)return;const{id:u,type:h,path:f}=Object.assign({path:[]},i.data),p=(i.data.argumentList||[]).map(l);let g;try{const n=f.slice(0,-1).reduce((t,e)=>t[e],e),r=f.reduce((t,e)=>t[e],e);switch(h){case 0:g=r;break;case 1:n[f.slice(-1)[0]]=l(i.data.value),g=!0;break;case 2:g=r.apply(n,p);break;case 3:g=function(e){return Object.assign(e,{[t]:!0})}(new r(...p));break;case 4:{const{port1:t,port2:n}=new MessageChannel;o(e,n),g=function(t,e){return c.set(t,e),t}(t,[t])}break;case 5:g=void 0}}catch(t){g=t,a.add(t)}Promise.resolve(g).catch(t=>(a.add(t),t)).then(t=>{const[e,a]=d(t);n.postMessage(Object.assign(Object.assign({},e),{id:u}),a),5===h&&(n.removeEventListener("message",r),s(n))})}),n.start&&n.start()}function s(t){(function(t){return"MessagePort"===t.constructor.name})(t)&&t.close()}function i(t){if(t)throw new Error("Proxy has been released and is not useable")}function u(t){const e=t.map(d);return[e.map(t=>t[0]),(n=e.map(t=>t[1]),Array.prototype.concat.apply([],n))];var n}const c=new WeakMap;function d(t){for(const[e,n]of r)if(n.canHandle(t)){const[a,r]=n.serialize(t);return[{type:3,name:e,value:a},r]}return[{type:0,value:t},c.get(t)||[]]}function l(t){switch(t.type){case 3:return r.get(t.name).deserialize(t.value);case 0:return t.value}}function h(t,e,n){return new Promise(a=>{const r=new Array(4).fill(0).map(()=>Math.floor(Math.random()*Number.MAX_SAFE_INTEGER).toString(16)).join("-");t.addEventListener("message",function e(n){n.data&&n.data.id&&n.data.id===r&&(t.removeEventListener("message",e),a(n.data))}),t.start&&t.start(),t.postMessage(Object.assign({id:r},e),n)})}const f={};var p=Math.PI,g=Math.sin,m=Math.cos,M=Math.tan,v=Math.asin,y=Math.atan2,w=Math.acos,b=p/180,P=864e5,E=2440588,k=2451545;function S(t){return function(t){return t.valueOf()/P-.5+E}(t)-k}var z=23.4397*b;function L(t,e){return y(g(t)*m(z)-M(e)*g(z),m(t))}function O(t,e){return v(g(e)*m(z)+m(e)*g(z)*g(t))}function j(t,e,n){return y(g(t),m(t)*g(e)-M(n)*m(e))}function D(t,e,n){return v(g(e)*g(n)+m(e)*m(n)*m(t))}function H(t,e){return b*(280.16+360.9856235*t)-e}function A(t){var e=function(t){return t+b*(1.9148*g(t)+.02*g(2*t)+3e-4*g(3*t))+102.9372*b+p}(function(t){return b*(357.5291+.98560028*t)}(t));return{dec:O(e,0),ra:L(e,0)}}f.getPosition=function(t,e,n){var a=b*-n,r=b*e,o=S(t),s=A(o),i=H(o,a)-s.ra;return{azimuth:j(i,r,s.dec),altitude:D(i,r,s.dec)}};var C=f.times=[[-.833,"sunrise","sunset"],[-.3,"sunriseEnd","sunsetStart"],[-6,"dawn","dusk"],[-12,"nauticalDawn","nauticalDusk"],[-18,"nightEnd","night"],[6,"goldenHourEnd","goldenHour"]];function I(t){var e=b*(134.963+13.064993*t),n=b*(93.272+13.22935*t),a=b*(218.316+13.176396*t)+6.289*b*g(e),r=5.128*b*g(n),o=385001-20905*m(e);return{ra:L(a,r),dec:O(a,r),dist:o}}function x(t,e){return new Date(t.valueOf()+e*P/24)}f.addTime=function(t,e,n){C.push([t,e,n])},f.getMoonPosition=function(t,e,n){var a=b*-n,r=b*e,o=S(t),s=I(o),i=H(o,a)-s.ra,u=D(i,r,s.dec),c=y(g(i),M(r)*m(s.dec)-g(s.dec)*m(i));return u+=function(t){return t<0&&(t=0),2967e-7/Math.tan(t+.00312536/(t+.08901179))}(u),{azimuth:j(i,r,s.dec),altitude:u,distance:s.dist,parallacticAngle:c}},f.getMoonIllumination=function(t){var e=S(t||new Date),n=A(e),a=I(e),r=w(g(n.dec)*g(a.dec)+m(n.dec)*m(a.dec)*m(n.ra-a.ra)),o=y(149598e3*g(r),a.dist-149598e3*m(r)),s=y(m(n.dec)*g(n.ra-a.ra),g(n.dec)*m(a.dec)-m(n.dec)*g(a.dec)*m(n.ra-a.ra));return{fraction:(1+m(o))/2,phase:.5+.5*o*(s<0?-1:1)/Math.PI,angle:s}},f.getMoonTimes=function(t,e,n,a){var r=new Date(t);a?r.setUTCHours(0,0,0,0):r.setHours(0,0,0,0);for(var o,s,i,u,c,d,l,h,p,g,m,M,v,y=.133*b,w=f.getMoonPosition(r,e,n).altitude-y,P=1;P<=24&&(o=f.getMoonPosition(x(r,P),e,n).altitude-y,h=((c=(w+(s=f.getMoonPosition(x(r,P+1),e,n).altitude-y))/2-o)*(l=-(d=(s-w)/2)/(2*c))+d)*l+o,g=0,(p=d*d-4*c*o)>=0&&(m=l-(v=Math.sqrt(p)/(2*Math.abs(c))),M=l+v,Math.abs(m)<=1&&g++,Math.abs(M)<=1&&g++,m<-1&&(m=M)),1===g?w<0?i=P+m:u=P+m:2===g&&(i=P+(h<0?M:m),u=P+(h<0?m:M)),!i||!u);P+=2)w=s;var E={};return i&&(E.rise=x(r,i)),u&&(E.set=x(r,u)),i||u||(E[h>0?"alwaysUp":"alwaysDown"]=!0),E},o({animateSun(t,e,n){const a=f.getPosition(t,n.lat,n.lon),r=100*a.altitude/(Math.PI/2);return{sunDegAngle:r,animationKey:e,sunBottomPosition:r+14+"vh",sunLeftPosition:a.azimuth/Math.PI*50+50}}});

<script>
  import { createEventDispatcher } from "svelte";
  export let activeForecast;
  let kelvins = 272.15;

  const dispatch = createEventDispatcher();
  let statToggled = {
    temp: { active: false, suffix: "°C" },
    rainsnow: { active: false, suffix: "%" },
    clouds: { active: false, suffix: "%" },
    wind: { active: false, suffix: "m/s" },
    humidity: { active: false, suffix: "%" },
    pressure: { active: false, suffix: "hPa" }
  };

  function showStats(type) {
    statToggled[type].active = !statToggled[type].active;
    dispatch("statToggle", statToggled);
  }
</script>

<style type="text/scss">
  @import "../variables.scss";
  .flex {
    display: flex;
    align-items: center;
    color: $colorBase;
    cursor: pointer;
  }

  .temp {
    color: $temp;
  }

  .pressure {
    color: $pressure;
  }

  .humidity {
    color: $humidity;
  }

  .clouds {
    color: $clouds;
  }

  .wind {
    color: $wind;
  }

  .rainsnow {
    color: $rainsnow;
  }

  table {
    margin: 0 auto;
  }

  .stats {
    margin: 0 1rem;
    padding-top: 3vh;

    tr + tr td {
      padding-top: 0.5rem;
    }

    td + td {
      padding-left: 2rem;
    }

    td {
      color: currentColor;
    }
  }

  .stat-icon {
    margin-right: 0.5rem;
    height: 4.5vh;
    max-height: 3rem;
    fill: currentColor;
  }
</style>

{#if activeForecast}
  <div class="stats">
    <table>
      <tr>

        <td>
          <div
            class="flex"
            class:temp={statToggled.temp.active}
            on:click={() => {
              showStats('temp');
            }}>
            <svg class="stat-icon" viewBox="0 0 16 28">
              <title>temperature</title>
              <path
                d="M10 21c0 1.656-1.344 3-3 3s-3-1.344-3-3c0-1.25 0.781-2.391
                2-2.828v-10.172h2v10.172c1.219 0.438 2 1.578 2 2.828zM12
                21c0-1.641-0.781-3.078-2-4v-12c0-1.656-1.344-3-3-3s-3 1.344-3
                3v12c-1.219 0.922-2 2.359-2 4 0 2.766 2.234 5 5 5s5-2.234
                5-5zM14 21c0 3.859-3.141 7-7 7s-7-3.141-7-7c0-1.906 0.766-3.625
                2-4.891v-11.109c0-2.766 2.234-5 5-5s5 2.234 5 5v11.109c1.234
                1.266 2 2.984 2 4.891zM16 12v2h-3v-2h3zM16 8v2h-3v-2h3zM16
                4v2h-3v-2h3z" />
            </svg>
            {(activeForecast.main.temp - kelvins).toFixed(1)}°C
          </div>
        </td>
        <td>
          <div
            class="flex"
            class:clouds={statToggled.clouds.active}
            on:click={() => {
              showStats('clouds');
            }}>

            <svg class="stat-icon" viewBox="0 0 32 32">
              <title>cloud</title>
              <path
                d="M25.914 13.143c-0.437-4.563-4.236-8.143-8.914-8.143-3.619
                0-6.717 2.148-8.146 5.23-0.43-0.136-0.878-0.23-1.353-0.23-2.485
                0-4.5 2.016-4.5 4.5 0 0.494 0.099 0.961 0.246 1.404-1.933
                1.127-3.246 3.195-3.246 5.594 0 3.59 2.91 6.5 6.5
                6.5v0.002l17.999-0.002c4.143 0 7.5-3.357 7.5-7.5
                0-3.656-2.621-6.693-6.086-7.355zM24.5
                25.998v0.002h-17.999c-2.481-0.002-4.5-2.020-4.5-4.502 0-1.6
                0.843-3.045 2.254-3.867 1.371-0.787 1.465-0.943
                0.89-2.357-0.097-0.291-0.144-0.544-0.144-0.773 0-1.379 1.121-2.5
                2.5-2.5 0 0 0.656-0.047 1.353 0.23 1.147 0.457 1.272 0.020
                1.814-1.159 1.147-2.473 3.632-4.072 6.332-4.072 3.6 0 6.576
                2.723 6.924 6.334 0.123 1.432 0.123 1.432 1.615 1.773 2.586
                0.494 4.461 2.762 4.461 5.391 0 3.033-2.467 5.5-5.5 5.5z" />
            </svg>
            {activeForecast.clouds.all || 0} %
          </div>
        </td>
        <td>
          <div
            class="flex"
            class:humidity={statToggled.humidity.active}
            on:click={() => {
              showStats('humidity');
            }}>
            <svg class="stat-icon " viewBox="0 0 24 24">
              <title>humidity</title>
              <path
                d="M12.707 1.983c-0.391-0.391-1.025-0.39-1.415 0.001l-5.653
                5.663c-1.757 1.758-2.635 4.063-2.634 6.365s0.88 4.607 2.638
                6.363c1.756 1.755 4.059 2.633 6.358 2.634 2.308-0.001
                4.613-0.881 6.37-2.638 1.755-1.756 2.633-4.059
                2.634-6.358-0.001-2.309-0.881-4.613-2.638-6.369zM12.001
                4.105l4.952 4.952c1.368 1.367 2.052 3.156 2.052 4.949s-0.682
                3.583-2.049 4.95-3.156 2.051-4.949
                2.052-3.583-0.682-4.95-2.049-2.051-3.156-2.052-4.949 0.682-3.583
                2.049-4.95z" />
            </svg>
            {activeForecast.main.humidity} %
          </div>
        </td>
      </tr>
      <tr>
        <td>
          <div
            class="flex"
            class:rainsnow={statToggled.rainsnow.active}
            on:click={() => {
              showStats('rainsnow');
            }}>
            {#if activeForecast.rain || !(activeForecast.rain || activeForecast.snow)}
              <svg class="stat-icon" viewBox="0 0 32 32">
                <title>rain</title>
                <path
                  d="M25 4c-0.332 0-0.66 0.023-0.987
                  0.070-1.867-2.544-4.814-4.070-8.013-4.070s-6.145 1.526-8.013
                  4.070c-0.327-0.047-0.655-0.070-0.987-0.070-3.859 0-7 3.141-7
                  7s3.141 7 7 7c0.856 0 1.693-0.156 2.482-0.458 1.81 1.578 4.112
                  2.458 6.518 2.458 2.409 0 4.708-0.88 6.518-2.458 0.789 0.302
                  1.626 0.458 2.482 0.458 3.859 0 7-3.141 7-7s-3.141-7-7-7zM25
                  16c-1.070 0-2.057-0.344-2.871-0.917-1.467 1.768-3.652
                  2.917-6.129 2.917s-4.662-1.148-6.129-2.917c-0.813 0.573-1.801
                  0.917-2.871 0.917-2.762 0-5-2.238-5-5s2.238-5 5-5c0.676 0
                  1.316 0.138 1.902 0.38 1.327-2.588 3.991-4.38 7.098-4.38s5.771
                  1.792 7.096 4.38c0.587-0.242 1.229-0.38 1.904-0.38 2.762 0 5
                  2.238 5 5s-2.238 5-5 5zM14.063 30c0 1.105 0.895 2 2 2s2-0.895
                  2-2-2-4-2-4-2 2.895-2 4zM22 28c0 1.105 0.895 2 2 2s2-0.895
                  2-2-2-4-2-4-2 2.895-2 4zM6 24c0 1.105 0.894 2 2 2s2-0.895
                  2-2-2-4-2-4-2 2.895-2 4z" />
              </svg>
              {#if activeForecast.rain}
                {(activeForecast.rain['3h'] / 3).toFixed(1)}
              {:else}0.0{/if}
              mm/h
            {/if}
            {#if activeForecast.snow}
              <svg class="stat-icon" viewBox="0 0 32 32">
                <title>snow</title>
                <path
                  d="M20.378 27.73l-1.125-0.648c0.034-0.195 0.060-0.394
                  0.060-0.602s-0.026-0.406-0.063-0.602l1.128-0.65c0.526-0.307
                  0.706-0.983
                  0.404-1.506-0.305-0.53-0.979-0.711-1.508-0.406l-1.137
                  0.656c-0.305-0.259-0.648-0.462-1.031-0.6v-1.306c0-0.611-0.496-1.105-1.105-1.105s-1.104
                  0.495-1.104 1.105v1.305c-0.383 0.137-0.728 0.342-1.033
                  0.602l-1.134-0.656c-0.53-0.305-1.206-0.125-1.51 0.405-0.305
                  0.526-0.121 1.203 0.406 1.508l1.122 0.648c-0.037 0.197-0.060
                  0.396-0.060 0.603s0.023 0.406 0.060 0.602l-1.122 0.648c-0.529
                  0.305-0.711 0.984-0.406 1.512s0.98 0.707 1.508
                  0.402l1.135-0.652c0.305 0.258 0.65 0.461 1.034 0.598v1.309c0
                  0.609 0.495 1.102 1.104 1.102s1.105-0.492
                  1.105-1.102v-1.309c0.383-0.137 0.73-0.34 1.033-0.602l1.135
                  0.656c0.529 0.305 1.203 0.125
                  1.508-0.402s0.125-1.203-0.404-1.512zM16 27.586c-0.609
                  0-1.105-0.496-1.105-1.105s0.496-1.103 1.105-1.103 1.104 0.494
                  1.104 1.103-0.495 1.105-1.104 1.105zM29.635
                  24.766l-0.755-0.201c-0.018-0.24-0.076-0.467-0.181-0.686l0.548-0.548c0.258-0.258
                  0.256-0.674 0-0.928-0.255-0.256-0.669-0.258-0.927 0l-0.549
                  0.547c-0.216-0.102-0.447-0.16-0.685-0.18l-0.201-0.754c-0.094-0.349-0.453-0.559-0.805-0.465-0.35
                  0.095-0.555 0.454-0.464 0.805l0.201 0.744c-0.099 0.068-0.193
                  0.143-0.281 0.229-0.086 0.089-0.159 0.182-0.227
                  0.279l-0.744-0.201c-0.35-0.094-0.712 0.117-0.806 0.465-0.094
                  0.352 0.117 0.71 0.464 0.805l0.75 0.202c0.021 0.236 0.081
                  0.466 0.186 0.685l-0.551 0.551c-0.255 0.256-0.254 0.671 0.003
                  0.926 0.255 0.255 0.669 0.258 0.924 0.003l0.552-0.552c0.216
                  0.107 0.448 0.167 0.688 0.185l0.198 0.751c0.096 0.35 0.453
                  0.559 0.805 0.465 0.349-0.094 0.56-0.453
                  0.466-0.807l-0.201-0.744c0.094-0.066 0.19-0.141 0.279-0.227
                  0.086-0.087 0.159-0.184 0.227-0.28l0.745 0.201c0.35 0.094
                  0.711-0.116 0.803-0.464
                  0.094-0.349-0.113-0.708-0.462-0.805zM27.395 25.184c-0.258
                  0.258-0.673 0.256-0.93 0-0.254-0.254-0.256-0.671 0-0.928
                  0.256-0.255 0.673-0.255 0.93 0 0.254 0.256 0.254 0.674 0
                  0.928zM7.434 21.406l-0.742
                  0.199c-0.069-0.094-0.141-0.189-0.228-0.277-0.088-0.086-0.182-0.16-0.28-0.227l0.199-0.746c0.094-0.35-0.115-0.711-0.461-0.803-0.352-0.094-0.711
                  0.115-0.805 0.464l-0.203 0.754c-0.238 0.020-0.466 0.078-0.684
                  0.181l-0.551-0.548c-0.258-0.258-0.672-0.256-0.927 0-0.256
                  0.256-0.256 0.672 0 0.928l0.548 0.548c-0.103 0.219-0.163
                  0.449-0.181 0.686l-0.753 0.201c-0.352 0.096-0.56 0.453-0.466
                  0.805 0.095 0.349 0.454 0.555 0.806 0.464l0.742-0.202c0.066
                  0.1 0.141 0.194 0.231 0.281 0.086 0.086 0.18 0.163 0.277
                  0.227l-0.199 0.744c-0.094 0.352 0.115 0.714 0.463 0.807 0.352
                  0.094 0.708-0.115 0.802-0.465l0.203-0.75c0.238-0.020
                  0.469-0.079 0.688-0.184l0.549 0.549c0.255 0.258 0.669 0.253
                  0.927-0.003 0.254-0.254 0.258-0.669
                  0-0.926l-0.551-0.551c0.106-0.216 0.168-0.449
                  0.184-0.688l0.754-0.199c0.348-0.095 0.556-0.453
                  0.462-0.805-0.094-0.348-0.453-0.556-0.806-0.465zM5.535
                  23.185c-0.256 0.256-0.672 0.256-0.93 0-0.254-0.255-0.254-0.673
                  0-0.927 0.258-0.255 0.673-0.255 0.93 0s0.254 0.672 0 0.927zM32
                  11c0-3.859-3.141-7-7-7-0.332 0-0.66 0.023-0.987
                  0.070-1.867-2.544-4.814-4.070-8.013-4.070s-6.145 1.526-8.013
                  4.070c-0.327-0.047-0.655-0.070-0.987-0.070-3.859 0-7 3.141-7
                  7s3.141 7 7 7c0.856 0 1.693-0.156 2.482-0.458 1.81 1.578 4.112
                  2.458 6.518 2.458 2.409 0 4.708-0.88 6.518-2.458 0.789 0.302
                  1.626 0.458 2.482 0.458 3.859 0 7-3.141 7-7zM22.129
                  15.083c-1.467 1.768-3.652 2.917-6.129
                  2.917s-4.662-1.148-6.129-2.917c-0.813 0.573-1.801 0.917-2.871
                  0.917-2.762 0-5-2.238-5-5s2.238-5 5-5c0.676 0 1.316 0.138
                  1.902 0.38 1.327-2.588 3.991-4.38 7.098-4.38s5.771 1.792 7.096
                  4.38c0.587-0.242 1.229-0.38 1.904-0.38 2.762 0 5 2.238 5
                  5s-2.238 5-5 5c-1.070 0-2.057-0.344-2.871-0.917z" />
              </svg>
              {(activeForecast.snow['3h'] / 3).toFixed(1)} mm/h
            {/if}
          </div>

        </td>
        <td>
          <div
            class="flex"
            class:wind={statToggled.wind.active}
            on:click={() => {
              showStats('wind');
            }}>
            <svg class="stat-icon " viewBox="0 0 24 24">
              <title>wind</title>
              <path
                d="M22.5 10.5c0-1.657-1.347-3-3-3-1.657 0-3 1.342-3
                3h1.5c0-0.828 0.666-1.5 1.5-1.5 0.828 0 1.5 0.666 1.5 1.5 0
                0.828-0.667 1.5-1.503 1.5h-17.247v1.5h17.251c1.656 0 2.999-1.347
                2.999-3v0zM15.75 7.5c0-1.657-1.347-3-3-3-1.657 0-3 1.342-3
                2.998v0.002h1.5c0-0.828 0.666-1.5 1.5-1.5 0.828 0 1.5 0.666 1.5
                1.5 0 0.828-0.673 1.5-1.504 1.5h-8.996v1.5h9.003c1.655 0
                2.997-1.347 2.997-3v0zM19.5 17.25c0 1.243-1.010 2.25-2.25
                2.25v0c-1.243 0-2.25-1.007-2.25-2.244v-0.006h1.5c0 0.414 0.333
                0.75 0.75 0.75v0c0.414 0 0.75-0.333
                0.75-0.75v0c0-0.414-0.337-0.75-0.756-0.75h-10.494v-1.5h10.5c1.243
                0 2.25 1.010 2.25 2.25v0 0z" />
            </svg>
            {activeForecast.wind.speed.toFixed(1)} m/s
          </div>
        </td>
        <td>
          <div
            class="flex"
            class:pressure={statToggled.pressure.active}
            on:click={() => {
              showStats('pressure');
            }}>
            <svg class="stat-icon " viewBox="0 0 30 28">
              <title>atmospheric pressure</title>
              <path
                d="M20
                14.5c0-0.281-0.219-0.5-0.5-0.5h-3.5v-5.5c0-0.266-0.234-0.5-0.5-0.5h-3c-0.266
                0-0.5 0.234-0.5 0.5v5.5h-3.5c-0.281 0-0.5 0.234-0.5 0.5 0 0.125
                0.047 0.266 0.141 0.359l5.5 5.5c0.094 0.094 0.219 0.141 0.359
                0.141 0.125 0 0.266-0.047 0.359-0.141l5.484-5.484c0.094-0.109
                0.156-0.234 0.156-0.375zM30 18c0 3.313-2.688 6-6 6h-17c-3.859
                0-7-3.141-7-7 0-2.719 1.578-5.187
                4.031-6.328-0.016-0.234-0.031-0.453-0.031-0.672 0-4.422 3.578-8
                8-8 3.25 0 6.172 1.969 7.406 4.969 0.719-0.625 1.641-0.969
                2.594-0.969 2.203 0 4 1.797 4 4 0 0.766-0.219 1.516-0.641 2.156
                2.719 0.641 4.641 3.063 4.641 5.844z" />
            </svg>
            {activeForecast.main.grnd_level} hPa
          </div>
        </td>
      </tr>
    </table>
  </div>
{/if}
